<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Attention is All You Need | 专注与突破</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;600;700&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: radial-gradient(ellipse at top, #0a0a0a 0%, #111111 40%, #000000 100%);
            color: #ffffff;
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }

        /* 增强的背景效果 */
        .particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
        }

        .particle {
            position: absolute;
            border-radius: 50%;
            background: linear-gradient(45deg, #00d4ff, #0099ff, #6366f1);
            animation: float 12s ease-in-out infinite;
            filter: blur(1px);
            will-change: transform, opacity;
        }

        @keyframes float {
            0%, 100% { 
                transform: translate(0, 0) scale(0.8); 
                opacity: 0.3; 
            }
            25% { 
                transform: translate(30px, -20px) scale(1.2); 
                opacity: 0.6; 
            }
            50% { 
                transform: translate(-20px, -40px) scale(1.5); 
                opacity: 0.9; 
            }
            75% { 
                transform: translate(40px, -30px) scale(1.1); 
                opacity: 0.5; 
            }
        }

        /* 神经网络风格的连接线 */
        .neural-network {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
            opacity: 0.1;
        }

        .connection-line {
            position: absolute;
            height: 1px;
            background: linear-gradient(90deg, transparent, #00d4ff, transparent);
            animation: pulse-line 8s ease-in-out infinite;
            will-change: opacity, transform;
        }

        @keyframes pulse-line {
            0%, 100% { opacity: 0.1; transform: scaleX(0.5); }
            50% { opacity: 0.4; transform: scaleX(1); }
        }

        .quantum-ring {
            position: absolute;
            border-radius: 50%;
            background: linear-gradient(45deg, transparent, rgba(0, 212, 255, 0.1), transparent);
            box-shadow: 0 0 80px rgba(0, 212, 255, 0.2), inset 0 0 80px rgba(99, 102, 241, 0.1);
            animation: quantum-pulse 6s ease-in-out infinite;
            will-change: transform, opacity;
        }

        @keyframes quantum-pulse {
            0%, 100% { 
                transform: scale(1) rotate(0deg); 
                opacity: 0.2; 
                filter: blur(3px);
            }
            50% { 
                transform: scale(1.15) rotate(180deg); 
                opacity: 0.4; 
                filter: blur(1px);
            }
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            position: relative;
            z-index: 1;
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 30px 40px;
            margin-bottom: 50px;
            backdrop-filter: blur(25px);
            border-radius: 30px;
            background: rgba(255, 255, 255, 0.03);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3), 
                        inset 0 1px 0 rgba(255, 255, 255, 0.1);
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 25px;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
            font-size: 2rem;
            font-weight: 700;
            background: linear-gradient(135deg, #00d4ff 0%, #6366f1 50%, #8b5cf6 100%);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            text-shadow: 0 0 30px rgba(0, 212, 255, 0.5);
            font-family: 'JetBrains Mono', monospace;
        }

        .logo i {
            font-size: 2.5rem;
            background: linear-gradient(135deg, #00d4ff, #6366f1);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            animation: logo-glow 3s ease-in-out infinite;
        }

        @keyframes logo-glow {
            0%, 100% { filter: drop-shadow(0 0 10px rgba(0, 212, 255, 0.5)); }
            50% { filter: drop-shadow(0 0 20px rgba(0, 212, 255, 0.8)); }
        }

        .settings-toggle {
            background: rgba(0, 212, 255, 0.05);
            backdrop-filter: blur(20px);
            border-radius: 50%;
            width: 55px;
            height: 55px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 101;
            position: relative;
            overflow: hidden;
            box-shadow: 0 4px 20px rgba(0, 212, 255, 0.2), 
                        inset 0 1px 0 rgba(255, 255, 255, 0.1);
        }

        .settings-toggle::before {
            content: '';
            position: absolute;
            inset: 0;
            border-radius: 50%;
            background: linear-gradient(135deg, rgba(0, 212, 255, 0.2), rgba(99, 102, 241, 0.2));
            opacity: 0;
            transition: opacity 0.4s ease;
        }

        .settings-toggle:hover::before {
            opacity: 1;
        }

        .settings-toggle:hover {
            transform: rotate(180deg) scale(1.1);
            box-shadow: 0 8px 30px rgba(0, 212, 255, 0.4), 
                        inset 0 1px 0 rgba(255, 255, 255, 0.2);
        }

        .settings-toggle i {
            font-size: 1.4rem;
            color: #00d4ff;
            z-index: 1;
            position: relative;
        }

        .stats {
            display: flex;
            gap: 25px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 30px;
            padding: 20px 30px;
            backdrop-filter: blur(25px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3), 
                        inset 0 1px 0 rgba(255, 255, 255, 0.1);
        }

        .stat-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            background: linear-gradient(135deg, #00d4ff, #6366f1);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            font-family: 'JetBrains Mono', monospace;
        }

        .stat-label {
            font-size: 0.9rem;
            color: #94a3b8;
            font-weight: 500;
        }

        .main-content {
            display: flex;
            flex: 1;
            gap: 50px;
        }

        .timer-section {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .timer-display {
            position: relative;
            width: 350px;
            height: 350px;
            margin: 50px 0;
        }

        .progress-ring {
            width: 100%;
            height: 100%;
            transform: rotate(-90deg);
            filter: drop-shadow(0 0 20px rgba(0, 212, 255, 0.3));
        }

        .progress-ring-circle {
            fill: none;
            stroke-width: 6;
            stroke-linecap: round;
            transition: stroke-dashoffset 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .timer-content {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            gap: 15px;
        }

        .timer-mode {
            font-size: 1.4rem;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 4px;
            opacity: 0.8;
            font-family: 'JetBrains Mono', monospace;
        }

        .timer-time {
            font-size: 4.5rem;
            font-weight: 300;
            font-variant-numeric: tabular-nums;
            position: relative;
            z-index: 10;
            font-family: 'JetBrains Mono', monospace;
            background: linear-gradient(135deg, #ffffff, #e2e8f0);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            text-shadow: 0 0 30px rgba(255, 255, 255, 0.3);
        }

        .timer-label {
            color: #94a3b8;
            font-size: 1.1rem;
            margin-top: 15px;
            font-weight: 500;
        }

        /* 增强的呼吸效果 */
        .breathing-bubble {
            position: absolute;
            width: 280px;
            height: 280px;
            background: radial-gradient(
                circle, 
                rgba(0, 212, 255, 0.4) 0%, 
                rgba(99, 102, 241, 0.3) 30%, 
                rgba(139, 92, 246, 0.2) 60%,
                transparent 100%
            );
            border-radius: 50%;
            filter: blur(25px);
            z-index: 1;
            animation: enhanced-breathe 3s ease-in-out infinite;
            display: none;
            will-change: transform, opacity;
        }

        .breathing-bubble::before {
            content: '';
            position: absolute;
            inset: 20px;
            border-radius: 50%;
            background: radial-gradient(
                circle,
                rgba(0, 212, 255, 0.3),
                rgba(99, 102, 241, 0.2),
                transparent
            );
            filter: blur(15px);
            animation: enhanced-breathe 3s ease-in-out infinite 0.5s;
        }

        .breathing-bubble::after {
            content: '';
            position: absolute;
            inset: 40px;
            border-radius: 50%;
            background: radial-gradient(
                circle,
                rgba(255, 255, 255, 0.1),
                transparent
            );
            filter: blur(10px);
            animation: enhanced-breathe 3s ease-in-out infinite 1s;
        }

        @keyframes enhanced-breathe {
            0%, 100% {
                transform: scale(0.7);
                opacity: 0.3;
            }
            25% {
                transform: scale(1.1);
                opacity: 0.6;
            }
            50% {
                transform: scale(1.4);
                opacity: 0.8;
            }
            75% {
                transform: scale(1.2);
                opacity: 0.5;
            }
        }

        .controls {
            display: flex;
            gap: 20px;
            margin-top: 30px;
        }

        .btn {
            padding: 15px 35px;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: 600;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            gap: 10px;
            position: relative;
            overflow: hidden;
            font-family: 'Inter', sans-serif;
            backdrop-filter: blur(20px);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3), 
                        inset 0 1px 0 rgba(255, 255, 255, 0.1);
        }

        .btn::before {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transform: translateX(-100%);
            transition: transform 0.6s ease;
        }

        .btn:hover::before {
            transform: translateX(100%);
        }

        .btn-primary {
            background: rgba(14, 165, 233, 0.7);
            color: #ffffff;
            box-shadow: 0 8px 25px rgba(14, 165, 233, 0.4), 
                        inset 0 1px 0 rgba(255, 255, 255, 0.2);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.05);
            color: #ffffff;
            backdrop-filter: blur(20px);
        }

        .btn:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 35px rgba(0, 212, 255, 0.6), 
                        inset 0 1px 0 rgba(255, 255, 255, 0.2);
        }

        .btn:active {
            transform: translateY(-2px);
        }

        .btn i {
            font-size: 1.3rem;
        }

        .mode-selector {
            display: flex;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 50px;
            padding: 8px;
            margin-top: 40px;
            backdrop-filter: blur(25px);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3), 
                        inset 0 1px 0 rgba(255, 255, 255, 0.1);
        }

        .mode-btn {
            padding: 15px 30px;
            border-radius: 40px;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            font-weight: 600;
            color: #94a3b8;
            font-family: 'Inter', sans-serif;
            backdrop-filter: blur(10px);
        }

        .mode-btn.active {
            background: rgba(14, 165, 233, 0.7);
            color: #ffffff;
            box-shadow: 0 8px 20px rgba(14, 165, 233, 0.4), 
                        inset 0 1px 0 rgba(255, 255, 255, 0.2);
        }

        .mode-btn:not(.active):hover {
            color: #ffffff;
            background: rgba(0, 212, 255, 0.1);
        }

        .suggestions-section {
            width: 350px;
            display: flex;
            flex-direction: column;
            gap: 30px;
        }

        .card {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 30px;
            padding: 30px;
            backdrop-filter: blur(25px);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2), 
                        inset 0 1px 0 rgba(255, 255, 255, 0.1);
        }

        .card:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3), 
                        inset 0 1px 0 rgba(255, 255, 255, 0.2);
        }

        .card-title {
            font-size: 1.4rem;
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            gap: 12px;
            background: linear-gradient(135deg, #00d4ff, #6366f1);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            font-weight: 600;
        }

        .card-title i {
            font-size: 1.6rem;
        }

        .suggestion-list {
            display: flex;
            flex-direction: column;
            gap: 18px;
        }

        .suggestion-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            border-radius: 20px;
            background: rgba(255, 255, 255, 0.02);
            backdrop-filter: blur(15px);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
            box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.05);
        }

        .suggestion-item:hover {
            background: rgba(0, 212, 255, 0.08);
            transform: translateX(8px);
            box-shadow: 0 4px 20px rgba(0, 212, 255, 0.2), 
                        inset 0 1px 0 rgba(255, 255, 255, 0.1);
        }

        .suggestion-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: rgba(0, 212, 255, 0.1);
            backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.3rem;
            box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.1);
        }

        .suggestion-text {
            flex: 1;
            font-size: 1rem;
            font-weight: 500;
        }

        /* 设置面板 - 移除矩形框，增加毛玻璃效果 */
        .settings-panel {
            position: absolute;
            top: 120px;
            left: 20px;
            background: rgba(15, 23, 42, 0.4);
            border-radius: 30px;
            padding: 30px;
            backdrop-filter: blur(30px);
            width: 380px;
            z-index: 100;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.4), 
                        inset 0 1px 0 rgba(255, 255, 255, 0.1);
            transform: translateY(-30px) translateX(-120%);
            opacity: 0;
            pointer-events: none;
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .settings-panel.show {
            transform: translateY(0) translateX(0);
            opacity: 1;
            pointer-events: all;
        }

        .setting-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 18px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .setting-item:last-child {
            border-bottom: none;
        }

        .setting-label {
            display: flex;
            align-items: center;
            gap: 12px;
            flex: 1;
            font-weight: 500;
        }

        .setting-input {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .setting-input input[type="range"] {
            width: 90px;
            height: 6px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
            outline: none;
            -webkit-appearance: none;
        }

        .setting-input input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: linear-gradient(135deg, #00d4ff, #6366f1);
            cursor: pointer;
            box-shadow: 0 2px 10px rgba(0, 212, 255, 0.5);
        }

        .setting-input input[type="range"]::-moz-range-thumb {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: linear-gradient(135deg, #00d4ff, #6366f1);
            cursor: pointer;
            border: none;
        }

        .setting-input .value-display {
            min-width: 35px;
            text-align: center;
            font-size: 0.95rem;
            color: #00d4ff;
            font-weight: 600;
            font-family: 'JetBrains Mono', monospace;
        }

        .switch {
            position: relative;
            display: inline-block;
            width: 55px;
            height: 28px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(255, 255, 255, 0.1);
            transition: .4s;
            border-radius: 28px;
            backdrop-filter: blur(10px);
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 3px;
            bottom: 3px;
            background-color: #94a3b8;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background: rgba(14, 165, 233, 0.7);
        }

        input:checked + .slider:before {
            transform: translateX(27px);
            background-color: #ffffff;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(0, 212, 255, 0.1);
            border-radius: 25px;
            padding: 20px 30px;
            backdrop-filter: blur(25px);
            transform: translateX(calc(100% + 30px));
            transition: transform 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 1000;
            display: flex;
            align-items: center;
            gap: 18px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3), 
                        inset 0 1px 0 rgba(255, 255, 255, 0.1);
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification-icon {
            font-size: 1.6rem;
            color: #00d4ff;
        }

        /* Mode specific styles */
        .focus-mode .progress-ring-circle { stroke: url(#gradientFocus); }
        .short-break-mode .progress-ring-circle { stroke: url(#gradientShortBreak); }
        .long-break-mode .progress-ring-circle { stroke: url(#gradientLongBreak); }

        .focus-mode .timer-mode { color: #00d4ff; }
        .short-break-mode .timer-mode { color: #0ea5e9; }
        .long-break-mode .timer-mode { color: #8b5cf6; }

        /* 音乐状态指示器 */
        .music-indicator {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(0, 212, 255, 0.1);
            border-radius: 50px;
            padding: 8px 16px;
            backdrop-filter: blur(15px);
            font-size: 0.9rem;
            color: #00d4ff;
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: 50;
            box-shadow: 0 4px 15px rgba(0, 212, 255, 0.2), 
                        inset 0 1px 0 rgba(255, 255, 255, 0.1);
        }

        .music-indicator.show {
            opacity: 1;
        }

        @media (max-width: 1100px) {
            .main-content {
                flex-direction: column;
            }
            
            .suggestions-section {
                width: 100%;
                margin-top: 30px;
            }
            
            .timer-display {
                width: 300px;
                height: 300px;
            }
            
            header {
                flex-direction: column;
                gap: 25px;
                align-items: stretch;
            }

            .header-left {
                width: 100%;
                justify-content: space-between;
            }
            
            .stats {
                justify-content: space-around;
            }
        }

        @media (max-width: 640px) {
            .timer-display {
                width: 260px;
                height: 260px;
            }
            
            .timer-time {
                font-size: 3.5rem;
            }
            
            .stats {
                width: 100%;
                justify-content: space-around;
                padding: 15px 20px;
            }
            
            .stat-value { 
                font-size: 1.6rem; 
            }
            
            .stat-label { 
                font-size: 0.85rem; 
            }
            
            .controls {
                flex-wrap: wrap;
                justify-content: center;
                gap: 15px;
            }
            
            .btn {
                padding: 12px 24px;
                font-size: 1rem;
            }

            .mode-selector {
                flex-wrap: wrap;
                justify-content: center;
            }
            
            .mode-btn {
                padding: 12px 20px;
                margin: 5px;
            }

            .settings-panel {
                width: calc(100% - 40px);
                left: 20px;
                right: 20px;
                top: 100px;
            }
            
            .notification {
                width: calc(100% - 40px);
                left: 20px;
                right: 20px;
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <div class="particles" id="particles"></div>
    <div class="neural-network" id="neural-network"></div>
    
    <div class="quantum-ring" style="width: 900px; height: 900px; top: -450px; right: -450px;"></div>
    <div class="quantum-ring" style="width: 700px; height: 700px; bottom: -350px; left: -350px;"></div>

    <div class="music-indicator" id="music-indicator">🎵 音乐播放中...</div>

    <div class="container">
        <header>
            <div class="header-left">
                <div class="settings-toggle" id="settings-toggle">
                    <i class="fas fa-cog"></i>
                </div>
                <div class="logo">
                    <i class="fas fa-brain"></i>
                    <span>Attention is All You Need</span>
                </div>
            </div>
            <div class="stats">
                <div class="stat-item">
                    <div class="stat-value" id="focus-count">0</div>
                    <div class="stat-label">专注次数</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="break-count">0</div>
                    <div class="stat-label">短休次数</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="long-break-count">0</div>
                    <div class="stat-label">长休次数</div>
                </div>
            </div>
        </header>
        
        <div class="settings-panel" id="settings-panel">
            <h3 class="card-title"><i class="fas fa-cog"></i> 设置</h3>
            <div class="setting-item">
                <div class="setting-label">
                    <i class="fas fa-volume-up"></i>
                    <span>提示音</span>
                </div>
                <label class="switch">
                    <input type="checkbox" id="sound-toggle" checked>
                    <span class="slider"></span>
                </label>
            </div>
            <div class="setting-item">
                <div class="setting-label">
                    <i class="fas fa-bell"></i>
                    <span>结束通知</span>
                </div>
                <label class="switch">
                    <input type="checkbox" id="notification-toggle" checked>
                    <span class="slider"></span>
                </label>
            </div>
            <div class="setting-item">
                <div class="setting-label">
                    <i class="fas fa-vibrate"></i>
                    <span>震动提醒</span>
                </div>
                <label class="switch">
                    <input type="checkbox" id="vibration-toggle">
                    <span class="slider"></span>
                </label>
            </div>
            <div class="setting-item">
                <div class="setting-label">
                    <i class="fas fa-paint-brush"></i>
                    <span>呼吸气泡效果</span>
                </div>
                <label class="switch">
                    <input type="checkbox" id="bubble-toggle" checked>
                    <span class="slider"></span>
                </label>
            </div>
            <div class="setting-item">
                <div class="setting-label">
                    <i class="fas fa-music"></i>
                    <span>专注结束音乐延迟</span>
                </div>
                <div class="setting-input">
                    <input type="range" id="focus-music-delay" min="0" max="30" value="10">
                    <div class="value-display" id="focus-music-delay-value">10s</div>
                </div>
            </div>
            <div class="setting-item">
                <div class="setting-label">
                    <i class="fas fa-spa"></i>
                    <span>休息结束前舒缓音乐</span>
                </div>
                <div class="setting-input">
                    <input type="range" id="break-music-delay" min="0" max="30" value="10">
                    <div class="value-display" id="break-music-delay-value">10s</div>
                </div>
            </div>
        </div>
        
        <div class="main-content">
            <div class="timer-section">
                <div class="timer-display">
                    <svg class="progress-ring" id="progress-ring" viewBox="0 0 350 350">
                        <defs>
                            <linearGradient id="gradientFocus" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" style="stop-color:#00d4ff;stop-opacity:1" />
                                <stop offset="50%" style="stop-color:#0ea5e9;stop-opacity:1" />
                                <stop offset="100%" style="stop-color:#0284c7;stop-opacity:1" />
                            </linearGradient>
                             <linearGradient id="gradientShortBreak" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" style="stop-color:#0ea5e9;stop-opacity:1" />
                                <stop offset="50%" style="stop-color:#0284c7;stop-opacity:1" />
                                <stop offset="100%" style="stop-color:#0369a1;stop-opacity:1" />
                            </linearGradient>
                             <linearGradient id="gradientLongBreak" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" style="stop-color:#8b5cf6;stop-opacity:1" />
                                <stop offset="50%" style="stop-color:#7c3aed;stop-opacity:1" />
                                <stop offset="100%" style="stop-color:#6d28d9;stop-opacity:1" />
                            </linearGradient>
                        </defs>
                        <circle class="progress-ring-circle" stroke="url(#gradientFocus)" stroke-width="6" fill="transparent" r="165" cx="175" cy="175"/>
                    </svg>
                    <div class="timer-content">
                        <div class="timer-mode" id="timer-mode">专注时间</div>
                        <div class="timer-time" id="timer">25:00</div>
                        <div class="breathing-bubble" id="breathing-bubble"></div>
                        <div class="timer-label" id="timer-label">开始专注工作</div>
                    </div>
                </div>
                
                <div class="controls">
                    <button class="btn btn-primary" id="start-btn">
                        <i class="fas fa-play"></i>
                        <span>开始</span>
                    </button>
                    <button class="btn btn-secondary" id="pause-btn">
                        <i class="fas fa-pause"></i>
                        <span>暂停</span>
                    </button>
                    <button class="btn btn-secondary" id="skip-btn">
                        <i class="fas fa-step-forward"></i>
                        <span>跳过</span>
                    </button>
                </div>
                
                <div class="mode-selector">
                    <div class="mode-btn active" data-mode="focus">专注 (25:00)</div>
                    <div class="mode-btn" data-mode="short-break">短休 (5:00)</div>
                    <div class="mode-btn" data-mode="long-break">长休 (15:00)</div>
                </div>
            </div>
            
            <div class="suggestions-section">
                <div class="card">
                    <h3 class="card-title"><i class="fas fa-lightbulb"></i> 休息建议</h3>
                    <div class="suggestion-list">
                        <div class="suggestion-item">
                            <div class="suggestion-icon">👀</div>
                            <div class="suggestion-text">远眺窗外，放松眼睛</div>
                        </div>
                        <div class="suggestion-item">
                            <div class="suggestion-icon">🧘‍♀️</div>
                            <div class="suggestion-text">深呼吸，放松身心</div>
                        </div>
                        <div class="suggestion-item">
                            <div class="suggestion-icon">💧</div>
                            <div class="suggestion-text">喝一杯水，补充水分</div>
                        </div>
                        <div class="suggestion-item">
                            <div class="suggestion-icon">🤸‍♂️</div>
                            <div class="suggestion-text">起身活动，伸展筋骨</div>
                        </div>
                        <div class="suggestion-item">
                            <div class="suggestion-icon">🎵</div>
                            <div class="suggestion-text">听一首轻松的音乐</div>
                        </div>
                    </div>
                </div>
                
                <div class="card">
                    <h3 class="card-title"><i class="fas fa-history"></i> 专注历史</h3>
                    <div class="suggestion-list" id="history-list">
                        <div class="suggestion-item">
                            <div class="suggestion-icon">⏱️</div>
                            <div class="suggestion-text">今天：<span id="today-focus-count">0</span>次专注, 共 <span id="today-focus-minutes">0</span>分钟</div>
                        </div>
                         <div class="suggestion-item">
                            <div class="suggestion-icon">🏆</div>
                            <div class="suggestion-text">最长专注：<span id="max-focus-duration">0</span>分钟</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="notification" id="notification">
        <div class="notification-icon">
            <i class="fas fa-bell"></i>
        </div>
        <div class="notification-text" id="notification-text">专注时间结束！该休息一下了。</div>
    </div>
    
    <audio id="alarm-sound" preload="auto">
        <source src="data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp4pZSEgxZqOD51mMcBTiS2e/VeSsFJHfH8N+OQAkWXbTp4pdSEQ==>" type="audio/wav">
    </audio>
    <audio id="focus-end-music" loop preload="auto">
        <source src="data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp4pZSEgxZqOD51mMcBTiS2e/VeSsFJHfH8N+OQAkWXbTp4pdSEQ==>" type="audio/wav">
    </audio>
    <audio id="break-end-music" loop preload="auto">
        <source src="data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp4pZSEgxZqOD51mMcBTiS2e/VeSsFJHfH8N+OQAkWXbTp4pdSEQ==>" type="audio/wav">
    </audio>

    <script>
        'use strict';

        // 性能优化和内存管理系统
        class PerformanceManager {
            constructor() {
                this.frameCount = 0;
                this.lastTime = Date.now();
                this.fpsHistory = [];
                this.memoryCleanupInterval = null;
                this.maxParticles = this.getOptimalParticleCount();
                this.cleanupTasks = [];
                this.isVisible = true;
                this.init();
            }

            init() {
                // 页面可见性检测
                document.addEventListener('visibilitychange', () => {
                    this.isVisible = !document.hidden;
                    this.handleVisibilityChange();
                });

                // 定期内存清理
                this.memoryCleanupInterval = setInterval(() => {
                    this.performMemoryCleanup();
                }, 30000); // 每30秒清理一次

                // 监听内存警告
                if ('memory' in performance) {
                    this.monitorMemoryUsage();
                }
            }

            getOptimalParticleCount() {
                const userAgent = navigator.userAgent.toLowerCase();
                const isMobile = /mobile|android|iphone|ipad/.test(userAgent);
                const isLowEnd = /android.*4\./.test(userAgent) || /iphone.*os [6-9]/.test(userAgent);
                
                if (isLowEnd) return 30;
                if (isMobile) return 60;
                return 80; // 减少从120到80
            }

            handleVisibilityChange() {
                if (this.isVisible) {
                    // 页面可见时恢复动画
                    this.resumeAnimations();
                } else {
                    // 页面隐藏时暂停动画以节省资源
                    this.pauseAnimations();
                }
            }

            pauseAnimations() {
                document.querySelectorAll('.particle, .connection-line, .quantum-ring').forEach(el => {
                    el.style.animationPlayState = 'paused';
                });
            }

            resumeAnimations() {
                document.querySelectorAll('.particle, .connection-line, .quantum-ring').forEach(el => {
                    el.style.animationPlayState = 'running';
                });
            }

            performMemoryCleanup() {
                // 清理未使用的DOM元素
                this.cleanupTasks.forEach(task => {
                    try {
                        task();
                    } catch (e) {
                        console.warn('Cleanup task failed:', e);
                    }
                });

                // 强制垃圾回收（如果可用）
                if (window.gc && typeof window.gc === 'function') {
                    window.gc();
                }

                // 检查内存使用情况
                if ('memory' in performance) {
                    const memory = performance.memory;
                    if (memory.usedJSHeapSize > memory.totalJSHeapSize * 0.9) {
                        console.warn('High memory usage detected, reducing particle count');
                        this.reduceParticleCount();
                    }
                }
            }

            reduceParticleCount() {
                const particles = document.querySelectorAll('.particle');
                const reduceBy = Math.min(particles.length * 0.2, 20);
                
                for (let i = 0; i < reduceBy; i++) {
                    if (particles[i]) {
                        particles[i].remove();
                    }
                }
            }

            monitorMemoryUsage() {
                const checkMemory = () => {
                    if ('memory' in performance) {
                        const memory = performance.memory;
                        const usagePercent = (memory.usedJSHeapSize / memory.totalJSHeapSize) * 100;
                        
                        if (usagePercent > 85) {
                            this.performMemoryCleanup();
                        }
                    }
                };

                setInterval(checkMemory, 10000); // 每10秒检查一次
            }

            addCleanupTask(task) {
                this.cleanupTasks.push(task);
            }

            destroy() {
                if (this.memoryCleanupInterval) {
                    clearInterval(this.memoryCleanupInterval);
                }
                this.cleanupTasks = [];
            }
        }

        // 初始化性能管理器
        const performanceManager = new PerformanceManager();

        // State Management
        const state = {
            mode: 'focus',
            running: false,
            timeLeft: 25 * 60,
            focusTime: 25 * 60,
            shortBreakTime: 5 * 60,
            longBreakTime: 15 * 60,
            interval: null,
            focusCount: 0,
            breakCount: 0,
            longBreakCount: 0,
            bubbleEnabled: true,
            focusMusicDelay: 10,
            breakMusicDelay: 10,
            focusMusicTimeout: null,
            breakMusicTimeout: null,
            todayFocusSessions: 0,
            todayFocusMinutes: 0,
            maxFocusDuration: 0,
            lastActiveDate: null,
            musicPlaying: false,
        };

        // DOM Elements Cache
        const elements = (() => {
            const cache = {};
            const ids = [
                'timer', 'timer-mode', 'timer-label', 'start-btn', 'pause-btn', 'skip-btn',
                'focus-count', 'break-count', 'long-break-count', 'progress-ring',
                'notification', 'notification-text', 'alarm-sound', 'focus-end-music',
                'break-end-music', 'sound-toggle', 'notification-toggle', 'vibration-toggle',
                'bubble-toggle', 'breathing-bubble', 'settings-toggle', 'settings-panel',
                'focus-music-delay', 'focus-music-delay-value', 'break-music-delay',
                'break-music-delay-value', 'today-focus-count', 'today-focus-minutes',
                'max-focus-duration', 'music-indicator'
            ];

            ids.forEach(id => {
                cache[id.replace(/-/g, '_')] = document.getElementById(id);
            });

            cache.progressCircle = document.querySelector('.progress-ring-circle');
            return cache;
        })();

        // Utility Functions
        const utils = {
            getTodayString: () => new Date().toDateString(),
            
            formatTime: (seconds) => {
                const mins = Math.floor(seconds / 60);
                const secs = seconds % 60;
                return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
            },

            debounce: (func, wait) => {
                let timeout;
                return function executedFunction(...args) {
                    const later = () => {
                        clearTimeout(timeout);
                        func(...args);
                    };
                    clearTimeout(timeout);
                    timeout = setTimeout(later, wait);
                };
            },

            throttle: (func, limit) => {
                let inThrottle;
                return function() {
                    const args = arguments;
                    const context = this;
                    if (!inThrottle) {
                        func.apply(context, args);
                        inThrottle = true;
                        setTimeout(() => inThrottle = false, limit);
                    }
                }
            }
        };

        // Enhanced particle system with memory optimization
        function createParticles() {
            const particlesContainer = document.getElementById('particles');
            if (!particlesContainer) return;
            
            const particleCount = performanceManager.maxParticles;
            const fragment = document.createDocumentFragment();
            
            for (let i = 0; i < particleCount; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = Math.random() * 100 + '%';
                particle.style.top = Math.random() * 100 + '%';
                particle.style.animationDelay = Math.random() * 12 + 's';
                particle.style.animationDuration = (Math.random() * 8 + 8) + 's';
                
                const size = (Math.random() * 3 + 1) + 'px';
                particle.style.width = size;
                particle.style.height = size;
                
                fragment.appendChild(particle);
            }
            
            particlesContainer.appendChild(fragment);

            // 添加清理任务
            performanceManager.addCleanupTask(() => {
                const particles = particlesContainer.querySelectorAll('.particle');
                if (particles.length > performanceManager.maxParticles * 1.5) {
                    const excess = particles.length - performanceManager.maxParticles;
                    for (let i = 0; i < excess; i++) {
                        particles[i].remove();
                    }
                }
            });
        }

        // Create neural network with optimized performance
        function createNeuralNetwork() {
            const neuralContainer = document.getElementById('neural-network');
            if (!neuralContainer) return;
            
            const lineCount = performanceManager.maxParticles < 60 ? 8 : 12; // 减少连接线数量
            const fragment = document.createDocumentFragment();
            
            for (let i = 0; i < lineCount; i++) {
                const line = document.createElement('div');
                line.className = 'connection-line';
                
                const angle = Math.random() * 360;
                const length = Math.random() * 200 + 80; // 减少长度范围
                const x = Math.random() * window.innerWidth;
                const y = Math.random() * window.innerHeight;
                
                line.style.left = x + 'px';
                line.style.top = y + 'px';
                line.style.width = length + 'px';
                line.style.transform = `rotate(${angle}deg)`;
                line.style.animationDelay = Math.random() * 8 + 's';
                
                fragment.appendChild(line);
            }
            
            neuralContainer.appendChild(fragment);
        }

        // Daily history management with error handling
        function checkAndResetDailyHistory() {
            const today = utils.getTodayString();
            
            if (state.lastActiveDate !== today) {
                state.todayFocusSessions = 0;
                state.todayFocusMinutes = 0;
                state.maxFocusDuration = 0;
                state.lastActiveDate = today;
                
                saveDailyHistory();
                updateHistoryStats();
            }
        }

        function saveDailyHistory() {
            try {
                const historyData = {
                    todayFocusSessions: state.todayFocusSessions,
                    todayFocusMinutes: state.todayFocusMinutes,
                    maxFocusDuration: state.maxFocusDuration,
                    lastActiveDate: state.lastActiveDate
                };
                localStorage.setItem('pomodoroHistory', JSON.stringify(historyData));
            } catch (e) {
                console.warn('Failed to save history to localStorage:', e);
            }
        }

        function loadDailyHistory() {
            try {
                const saved = localStorage.getItem('pomodoroHistory');
                if (saved) {
                    const historyData = JSON.parse(saved);
                    const today = utils.getTodayString();
                    
                    if (historyData.lastActiveDate === today) {
                        state.todayFocusSessions = historyData.todayFocusSessions || 0;
                        state.todayFocusMinutes = historyData.todayFocusMinutes || 0;
                        state.maxFocusDuration = historyData.maxFocusDuration || 0;
                        state.lastActiveDate = historyData.lastActiveDate;
                    } else {
                        state.lastActiveDate = today;
                        saveDailyHistory();
                    }
                } else {
                    state.lastActiveDate = utils.getTodayString();
                }
            } catch (e) {
                console.warn('Failed to load history from localStorage:', e);
                state.lastActiveDate = utils.getTodayString();
            }
        }

        // Enhanced music control with better error handling
        function showMusicIndicator(show, text = '🎵 音乐播放中...') {
            if (show && !state.musicPlaying) {
                elements.music_indicator.textContent = text;
                elements.music_indicator.classList.add('show');
                state.musicPlaying = true;
            } else if (!show && state.musicPlaying) {
                elements.music_indicator.classList.remove('show');
                state.musicPlaying = false;
            }
        }

        function clearMusicTimeouts() {
            if (state.focusMusicTimeout) {
                clearTimeout(state.focusMusicTimeout);
                state.focusMusicTimeout = null;
            }
            if (state.breakMusicTimeout) {
                clearTimeout(state.breakMusicTimeout);
                state.breakMusicTimeout = null;
            }
            showMusicIndicator(false);
        }

        function stopAllMusic() {
            try {
                elements.focus_end_music.pause();
                elements.focus_end_music.currentTime = 0;
                elements.break_end_music.pause();
                elements.break_end_music.currentTime = 0;
            } catch (e) {
                console.warn('Error stopping music:', e);
            }
            showMusicIndicator(false);
        }

        // Timer functions with performance optimization
        const updateTimerDisplay = utils.throttle(() => {
            const timeString = utils.formatTime(state.timeLeft);
            
            if (elements.timer.textContent !== timeString) {
                elements.timer.textContent = timeString;
                document.title = `${timeString} - ${elements.timer_mode.textContent} | Attention is All You Need`;
            }
            
            updateProgressRing();
        }, 100); // 限制更新频率

        function updateProgressRing() {
            const radius = parseFloat(elements.progressCircle.getAttribute('r'));
            const circumference = 2 * Math.PI * radius;
            let timeTotal;
            
            switch(state.mode) {
                case 'focus': timeTotal = state.focusTime; break;
                case 'short-break': timeTotal = state.shortBreakTime; break;
                case 'long-break': timeTotal = state.longBreakTime; break;
                default: timeTotal = state.focusTime;
            }
            
            const offset = circumference - (state.timeLeft / timeTotal) * circumference;
            elements.progressCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            elements.progressCircle.style.strokeDashoffset = Math.max(0, offset);
        }

        function scheduleFocusEndMusic() {
            if (state.mode !== 'focus' || !elements.sound_toggle.checked) return;
            
            const delayMs = state.focusMusicDelay * 1000;
            state.focusMusicTimeout = setTimeout(() => {
                showMusicIndicator(true, '🎵 专注结束音乐');
                elements.focus_end_music.play()
                    .then(() => {
                        setTimeout(() => {
                            elements.focus_end_music.pause();
                            elements.focus_end_music.currentTime = 0;
                            showMusicIndicator(false);
                        }, 20000);
                    })
                    .catch(e => {
                        console.warn("Focus end music play failed:", e);
                        showMusicIndicator(false);
                    });
            }, delayMs);
        }

        function scheduleBreakEndMusic() {
            if (state.mode === 'focus' || !elements.sound_toggle.checked) return;
            
            const timeBeforeEnd = state.breakMusicDelay;
            const triggerTime = state.timeLeft - timeBeforeEnd;
            
            if (triggerTime <= 0) {
                showMusicIndicator(true, '🎵 休息结束音乐');
                elements.break_end_music.play()
                    .catch(e => {
                        console.warn("Break end music play failed:", e);
                        showMusicIndicator(false);
                    });
                return;
            }
            
            const delayMs = triggerTime * 1000;
            state.breakMusicTimeout = setTimeout(() => {
                showMusicIndicator(true, '🎵 休息结束音乐');
                elements.break_end_music.play()
                    .catch(e => {
                        console.warn("Break end music play failed:", e);
                        showMusicIndicator(false);
                    });
            }, delayMs);
        }

        // Main timer functions
        function setMode(mode) {
            clearMusicTimeouts();
            stopAllMusic();
            
            state.mode = mode;
            document.querySelectorAll('.mode-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.mode === mode);
            });
            
            document.body.classList.remove('focus-mode', 'short-break-mode', 'long-break-mode');
            document.body.classList.add(`${mode}-mode`);
            
            let currentGradientUrl;
            switch(mode) {
                case 'focus':
                    state.timeLeft = state.focusTime;
                    elements.timer_mode.textContent = '专注时间';
                    elements.timer_label.textContent = '开始专注工作';
                    currentGradientUrl = 'url(#gradientFocus)';
                    break;
                case 'short-break':
                    state.timeLeft = state.shortBreakTime;
                    elements.timer_mode.textContent = '短时休息';
                    elements.timer_label.textContent = '放松一下，休息5分钟';
                    currentGradientUrl = 'url(#gradientShortBreak)';
                    break;
                case 'long-break':
                    state.timeLeft = state.longBreakTime;
                    elements.timer_mode.textContent = '长时休息';
                    elements.timer_label.textContent = '好好放松，休息15分钟';
                    currentGradientUrl = 'url(#gradientLongBreak)';
                    break;
                default:
                    currentGradientUrl = 'url(#gradientFocus)';
            }
            elements.progressCircle.setAttribute('stroke', currentGradientUrl);
            updateTimerDisplay();
        }

        function startTimer() {
            if (state.timeLeft <= 0) resetTimer();
            if (state.running) return;
            
            state.running = true;
            elements.start_btn.innerHTML = '<i class="fas fa-redo"></i><span>重置</span>';
            elements.pause_btn.disabled = false;
            
            if (state.mode === 'focus') {
                scheduleFocusEndMusic();
            } else {
                scheduleBreakEndMusic();
            }
            
            state.interval = setInterval(() => {
                state.timeLeft--;
                updateTimerDisplay();
                
                if (state.timeLeft < 0) {
                    clearInterval(state.interval);
                    state.timeLeft = 0;
                    updateTimerDisplay();
                    timerComplete();
                }
            }, 1000);
        }

        function pauseTimer() {
            if (!state.running) return;
            
            clearInterval(state.interval);
            clearMusicTimeouts();
            stopAllMusic();
            state.running = false;
            elements.start_btn.innerHTML = '<i class="fas fa-play"></i><span>继续</span>';
            elements.pause_btn.disabled = true;
        }

        function resetTimer() {
            clearInterval(state.interval);
            clearMusicTimeouts();
            stopAllMusic();
            state.running = false;
            
            setMode(state.mode);
            
            elements.start_btn.innerHTML = '<i class="fas fa-play"></i><span>开始</span>';
            elements.pause_btn.disabled = false;
            updateTimerDisplay();
        }
        
        function updateHistoryStats() {
            checkAndResetDailyHistory();
            
            elements.today_focus_count.textContent = state.todayFocusSessions;
            elements.today_focus_minutes.textContent = state.todayFocusMinutes;
            elements.max_focus_duration.textContent = state.maxFocusDuration;
        }

        function timerComplete() {
            state.running = false;
            clearMusicTimeouts();
            
            if (elements.sound_toggle.checked) {
                elements.alarm_sound.play().catch(e => console.warn("Audio play failed:", e));
            }
            
            if (elements.vibration_toggle.checked && navigator.vibrate) {
                navigator.vibrate([200, 100, 200]);
            }
            
            if (elements.notification_toggle.checked) {
                let message = '';
                if (state.mode === 'focus') {
                    message = '专注时间结束！该休息一下了。';
                } else {
                    message = '休息时间结束！该继续专注工作了。';
                }
                showNotification(message);
            }
            
            if (state.mode === 'focus') {
                state.focusCount++;
                elements.focus_count.textContent = state.focusCount;
                
                state.todayFocusSessions++;
                const sessionMinutes = Math.floor(state.focusTime / 60);
                state.todayFocusMinutes += sessionMinutes;
                
                if (sessionMinutes > state.maxFocusDuration) {
                    state.maxFocusDuration = sessionMinutes;
                }
                
                saveDailyHistory();
                updateHistoryStats();

                if (state.focusCount > 0 && state.focusCount % 4 === 0) {
                    setMode('long-break');
                } else {
                    setMode('short-break');
                }
            } else if (state.mode === 'short-break') {
                state.breakCount++;
                elements.break_count.textContent = state.breakCount;
                setMode('focus');
            } else if (state.mode === 'long-break') {
                state.longBreakCount++;
                elements.long_break_count.textContent = state.longBreakCount;
                setMode('focus');
            }
            
            elements.start_btn.innerHTML = '<i class="fas fa-play"></i><span>开始</span>';
        }

        function skipTimer() {
            clearInterval(state.interval);
            clearMusicTimeouts();
            stopAllMusic();
            state.timeLeft = 0;
            updateTimerDisplay();
            timerComplete();
        }

        function showNotification(text) {
            elements.notification_text.textContent = text;
            elements.notification.classList.add('show');
            
            setTimeout(() => {
                elements.notification.classList.remove('show');
            }, 5000);
        }

        function toggleBubbleEffect() {
            elements.breathing_bubble.style.display = state.bubbleEnabled ? 'block' : 'none';
        }

        function updateMusicDelayDisplays() {
            elements.focus_music_delay_value.textContent = state.focusMusicDelay + 's';
            elements.break_music_delay_value.textContent = state.breakMusicDelay + 's';
        }

        // Event handlers with memory optimization
        const handleStartButton = utils.debounce(() => {
            if (elements.start_btn.textContent.includes('重置') || elements.start_btn.textContent.includes('Reset')) {
                resetTimer();
            } else if (state.running) {
                pauseTimer(); 
            } else {
                startTimer();
            }
        }, 100);

        const handleDocumentClick = (e) => {
            if (elements.settings_panel.classList.contains('show') &&
                !elements.settings_panel.contains(e.target) &&
                !elements.settings_toggle.contains(e.target)) {
                elements.settings_panel.classList.remove('show');
            }
        };

        // Initialize application
        function init() {
            loadDailyHistory();
            
            createParticles();
            createNeuralNetwork();
            setMode('focus');
            
            state.bubbleEnabled = elements.bubble_toggle.checked;
            
            elements.focus_music_delay.value = state.focusMusicDelay;
            elements.break_music_delay.value = state.breakMusicDelay;
            updateMusicDelayDisplays();
            
            // Event listeners with proper cleanup
            document.addEventListener('click', handleDocumentClick, { passive: true });
            
            document.querySelectorAll('.mode-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    setMode(btn.dataset.mode);
                    resetTimer();
                }, { passive: true });
            });
            
            elements.start_btn.addEventListener('click', handleStartButton);
            elements.pause_btn.addEventListener('click', pauseTimer);
            elements.skip_btn.addEventListener('click', skipTimer);
            
            elements.bubble_toggle.addEventListener('change', () => {
                state.bubbleEnabled = elements.bubble_toggle.checked;
                toggleBubbleEffect();
            });
            
            // Music delay controls with debouncing
            const updateFocusDelay = utils.debounce((e) => {
                state.focusMusicDelay = parseInt(e.target.value);
                updateMusicDelayDisplays();
            }, 150);
            
            const updateBreakDelay = utils.debounce((e) => {
                state.breakMusicDelay = parseInt(e.target.value);
                updateMusicDelayDisplays();
            }, 150);
            
            elements.focus_music_delay.addEventListener('input', updateFocusDelay);
            elements.break_music_delay.addEventListener('input', updateBreakDelay);
            
            elements.settings_toggle.addEventListener('click', (e) => {
                e.stopPropagation();
                elements.settings_panel.classList.toggle('show');
            });
            
            toggleBubbleEffect();
            updateHistoryStats();
            elements.pause_btn.disabled = true;
            
            // Cleanup interval
            setInterval(checkAndResetDailyHistory, 3600000);

            // 添加页面卸载清理
            window.addEventListener('beforeunload', () => {
                clearInterval(state.interval);
                clearMusicTimeouts();
                stopAllMusic();
                performanceManager.destroy();
            });
        }

        // 错误处理
        window.addEventListener('error', (e) => {
            console.error('Application error:', e.error);
            // 尝试恢复
            if (state.interval) {
                clearInterval(state.interval);
                state.running = false;
                elements.start_btn.innerHTML = '<i class="fas fa-play"></i><span>开始</span>';
            }
        });

        // 启动应用
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', init);
        } else {
            init();
        }
    </script>
</body>
</html>
